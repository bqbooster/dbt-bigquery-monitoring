# Changelog
All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html),
and is generated by [Changie](https://github.com/miniscruff/changie).

## dbt-bigquery-monitoring v0.22.0 - July 20, 2025

### Features


  - Add missing new INFORMATION_SCHEMA models and add organization models tag

### Fixes


  - Fix input_gcp_projects parsing and avoid fromjson for dbt_fusion compatibility

### Under the Hood


  - Update dbt-bigquery to 1.10.0 in CI

  - Disable by default organization models

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.21.0 - July 06, 2025

### Features


  - New variable system that ensure that variable priority is well respected to improve configuration consistency and fix options output

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.20.4 - July 01, 2025

### Fixes


  - Fix regressions regarding reservations fields (now builtin parser)

  - Fix reading the right tables in 'dataset' based tables (e.g. search indexes ones)

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.20.3 - July 01, 2025

### Fixes


  - Use dataset level for indexes tables as required by the documentation ([#128](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/128))

### Under the Hood


  - Disable by default 'by folder' models as they are often problematic for users that don't have folders ([#128](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/128))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#128](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/128), [#128](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/128))


## dbt-bigquery-monitoring v0.20.2 - June 30, 2025

### Fixes


  - Fix data duplication with project mode using default bq monitoring materialization ([#129](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/129))

### Under the Hood


  - Rework the meta to put it under the config block to avoid dbt warnings

  - Remove query from information_schema_jobs_by_organization as not accessible

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#129](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/129))


## dbt-bigquery-monitoring v0.20.1 - June 25, 2025

### Fixes


  - Move type to config.meta.type to avoid linter warnings ([#124](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/124))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#124](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/124))


## dbt-bigquery-monitoring v0.20.0 - June 22, 2025

### Features


  - Add total_bytes_processed to compute cost per hour model and upstream models

  - Ensure minute-to-hour model consistency by adding missing metrics to rollup and cost models, creating reservation_usage_per_hour model, and standardizing schema definitions across all intermediate models

  - Update materialization logic to return 'project_by_project_view' when explicit projects are provided, ensuring proper handling of project references in views

  - Add new models for BI Engine and job analysis, including materialized view effectiveness and job failure patterns

  - Add materialization for project_by_project_view in BigQuery to support multi-project monitoring scenarios

### Docs


  - Update the doc to make clearer how to run the package

### Under the Hood


  - Update the information schema fields to add new fields

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.19.3 - March 28, 2025

### Fixes


  - Fix an incremental case where we would still insert more than 4000 partitions per statement on existing tables with full refresh

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.19.2 - March 27, 2025

### Fixes


  - Fix target_relation regression in project_by_project_table materialization

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.19.1 - March 26, 2025

### Fixes


  - Support hard refreshing tables when the partitioning / clustering changes

  - Ensure we have proper aligned columns to insert the data in project by project table

  - Ensure that the incremental case won't try to insert more than 4000 partitions per statement

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.19.0 - March 25, 2025

### Features


  - Update the information schema models and fixes partitioning / clustering detection on those base tables

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.18.4 - February 21, 2025

### Fixes


  - Fix audit logs upper bound for jobs models

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.18.3 - February 20, 2025

### Fixes


  - Fix query_with_better_pricing views formulas

  - Fix job read when no data in existing table

### Under the Hood


  - remove unused jobs_done_incremental_minute

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.18.2 - February 11, 2025

### Fixes


  - Move up the dbt-bigquery-monitoring tag should wrap also information schema for project_by_project_table materialization

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.18.1 - January 13, 2025

### Fixes


  - Fix the full refresh mode for information_schema table that are not partitioned

  - Fix the number of inserts for stats by using the right statement as main

### Docs


  - Adjust the documentation to match the update of information schema materialization

### Under the Hood


  - Rework the structure of models to tag only the monitoring models

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.18.0 - January 13, 2025

### Features


  - Improve the scalability of the project approach by factoring them into a table

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.17.2 - January 06, 2025

### Fixes


  - Fix DBT_BQ_MONITORING_GCP_PROJECTS being required while it should not for region mode

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.17.1 - January 05, 2025

### Fixes


  - Fix bi engine statistics structure not consistent between audit logs & information schema

  - Fix materialized_as_view_if_explicit_projects macro as not working as intended in region mode

  - Protect get_query_comment against potential undefined

### Docs


  - Improve the documentation regarding combining audit logs with information schema jobs data

### Under the Hood


  - Small changes to fix compatibility with SQLMesh

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.17.0 - December 13, 2024

### Features


  - Allow to combine audit logs and information schema jobs table to have the best of both worlds

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.16.0 - December 09, 2024

### Features


  - Support for audit logs ([#61](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/61))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#61](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/61))


## dbt-bigquery-monitoring v0.15.0 - December 03, 2024

### Features


  - Add client type support to breakdown by type of workload ([#68](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/68))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#68](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/68))


## dbt-bigquery-monitoring v0.14.3 - November 27, 2024

### Fixes


  - Fix stg_partitions_monitoring that wasn't exhaustive because of a restriction on partition expiration based tables ([#79](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/79))

  - Restrain stg_partitions_monitoring to partitioned tables

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#79](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/79))


## dbt-bigquery-monitoring v0.14.2 - November 24, 2024

### Fixes


  - Rework models to use `project_id` prefix if possible and use `ephemeral` if relevant ([#74](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/74))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#74](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/74))


## dbt-bigquery-monitoring v0.14.1 - November 19, 2024

### Under the Hood


  - Update Google base models based on latest documentation parsing ([#71](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/71))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#71](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/71))


## dbt-bigquery-monitoring v0.14.0 - November 18, 2024

### Features


  - New compute optimization oriented views ([#59](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/59))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#59](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/59))


## dbt-bigquery-monitoring v0.13.0 - November 17, 2024

### Features


  - Add BI engine usage monitoring ([#58](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/58))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#58](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/58))


## dbt-bigquery-monitoring v0.12.0 - November 16, 2024

### Features


  - Add reservation_usage_per_minute ([#57](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/57))

### Fixes


  - Fix compute cost per minute that would override latest hour because it is leveraging insert_overwrite.

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#57](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/57))


## dbt-bigquery-monitoring v0.11.1 - November 08, 2024

### Fixes


  - Fix lookback for compute billing and make it customizable via `lookback_incremental_billing_window_days` var

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.11.0 - November 04, 2024

### Features


  - Add storage costs to daily_spend when using GCP cost export

  - Add compute_cost_per_minute for precise compute cost tracking

### Fixes


  - Add equality on incremental models to avoid cases where hours could be skipped

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.10.3 - October 27, 2024

### Fixes


  - SAFE_CAST option_value to avoid potential cast errors

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.10.2 - October 26, 2024

### Fixes


  - Fix information_schema_partition failing when schema isn't in the same gcp project as execution project

  - Add lookback for 3 days on gcp billing export usage ([#44](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/44))

### Under the Hood


  - Clean up log in get_query_comment"

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#44](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/44))


## dbt-bigquery-monitoring v0.10.1 - October 19, 2024

### Under the Hood


  - Migrate in another repo documentation parser to reduce the package size from useless files

    - clean "No datasets found in the project list" log ([#35](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/35))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#35](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/35))


## dbt-bigquery-monitoring v0.10.0 - October 15, 2024

### Features


  - Add partition_expiration_days to partition & move to view the partitions_monitoring model as it is just adding computed fields on stg_partitions_monitoring

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.9.1 - October 09, 2024

### Fixes


  - Fixes queries related datamart that were storing running/pending jobs thus returning partial numbers

  - Fix is_incremental_run that wasn't working and replaced with a macro to inline proper incremental behavior

  - Bugs on macros copy_partition / gcp billing export

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.9.0 - October 06, 2024

### Features


  - Add GCP billing export support

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.8.0 - October 02, 2024

### Features


  - partition expiration is now configurable

  - Leverage copy_partitions by default (but configurable as well)

### Under the Hood


  - Add CI testing

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.7.3 - September 30, 2024

### Fixes


    - rename macro to workaround a <1.6 bug ([#26](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/26))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#26](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/26))


## dbt-bigquery-monitoring v0.7.2 - September 24, 2024

### Fixes


    - Fix the version defined in get_query_comment macro ([#19](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/19))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#19](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/19))


## dbt-bigquery-monitoring v0.7.1 - September 24, 2024

### Fixes


    - Fix the name of the dbt_bigquery_monitoring_options model ([#17](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/17))

### Contributors
- [@gofford](https://github.com/gofford) ([#17](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/17))


## dbt-bigquery-monitoring v0.7.0 - September 01, 2024

### Features


  - new partitions monitoring model

### Fixes


  - Fix dataset based google models such as partitions

### Contributors
- [@Kayrnt](https://github.com/Kayrnt)


## dbt-bigquery-monitoring v0.6.0 - August 20, 2024

### Breaking Changes

- Update google models, add new dataset with costs and clean up ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))


## dbt-bigquery-monitoring v0.5.4 - August 19, 2024

### Features

- Add a model with properties ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))


## dbt-bigquery-monitoring v0.5.3 - August 12, 2024

### Docs

- Add missing YML for billing models ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))


## dbt-bigquery-monitoring v0.5.2 - August 01, 2024

### Fixes

- Fix information_schema_schemata_links model information ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))


## dbt-bigquery-monitoring v0.5.1 - July 30, 2024

### Fixes

- Fix YML model name misaligned with information schema dbt models ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))


## dbt-bigquery-monitoring v0.5.0 - June 05, 2024

### Features

- Add new models for storage monitoring ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))
- Add SQLMesh support ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))

### Contributors
- [@Kayrnt](https://github.com/Kayrnt) ([#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0), [#0](https://github.com/bqbooster/dbt-bigquery-monitoring/issues/0))


## dbt-bigquery-monitoring v0.4.0 - May 18, 2024

### Features

- Add ephemeral models for all Google metadata tables (along generation script in /documentation_parser)
- Add the "region mode" to avoid listing explicitly GCP projects

## dbt-bigquery-monitoring v0.3.0 - February 18, 2024

### Breaking Changes

- Uniformize fields to count queries to query_count and improve the dbt docs ([#0](https://github.com/Kayrnt/dbt-bigquery-monitoring/issues/0))

## dbt-bigquery-monitoring v0.2.0 - October 17, 2023

### Breaking Changes

- fix storage_with_cost.yml ([#0](https://github.com/Kayrnt/dbt-bigquery-monitoring/issues/0))

## dbt-bigquery-monitoring v0.1.0 - October 08, 2023

### Breaking Changes

- Fix the incremental tables not working as intended ([#1](https://github.com/Kayrnt/dbt-bigquery-monitoring/issues/1))

